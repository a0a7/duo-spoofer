<!DOCTYPE html>
<script src="encryption.js"></script>
<script src="secure-storage.js"></script>
<script src="libs/buffer.js"></script>
<script src="libs/index.js"></script>
<script type="module" src="popup.js"></script>
<html>

<head>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>

<!-- display-none prevents weird visual artifacts from appearing while loading. JS clears the display -->
<body id="content" style="display: none">
  <!-- Logo centered at top -->
  <div style="text-align: center; padding: 16px 0 8px 0;">
    <img style="width: 80px; height: auto; border: none;" src="welcome/logo.png" alt="autoauth" />
  </div>
  
  <div style="display: flex; gap: 8px; align-items: center; padding: 0 16px;">
    <!-- Select device -->
    <select id="deviceSelect">
      <option value="-1">Add Device...</option>
    </select>
    <!-- Device TOTP -->
    <!-- TOTP -->
    <a id="totp" style="display: none;">
      <svg viewBox="0 0 16 16">
        <circle cx="8" cy="8" r="4" id="totpCircle" style="animation-duration: 30s"></circle>
      </svg>
      <p id="totpCode"></p>
    </a>
  </div>
  <hr style="margin: 8px 16px;" />

  <!-- Welcome screen -->
  <div class="screen" id="intro">
    <h4 id="disclaimerText">
      By using this extension, you understand the <a href="https://github.com/FreshSupaSulley/Auto-2FA/blob/main/README.md#security" target="_blank">risks</a>, including unauthorized access or data loss. The developers are not liable for any consequences.
    </h4>
    <hr />
    <h4>
      You're about to add a device to your Duo Mobile account. Login to your
      Duo device manager website.
    </h4>
    <button type="submit" id="introButton">Ok</button>
  </div>

  <!-- Activation screen -->
  <div class="screen" id="activation">
    <div id="errorSplash" style="margin-bottom: 16px; font-weight: 500; color: #e74c3c;">
    </div>
    
    <!-- QR Code Detection Section -->
    <div style="margin-bottom: 24px;">
      <h4 style="margin: 0 0 12px 0; font-size: 16px;">Automatic Detection</h4>
      <p id="qrSearchText" style="margin: 0 0 8px 0; font-weight: 500;">Searching for a QR code...</p>
      <p id="qrErrorText" style="margin: 0 0 8px 0; color: #e74c3c;"></p>
      <p style="margin: 0; font-weight: normal; color: #666; font-size: 14px;">
        autoauth will find the QR code on the current tab.
      </p>
    </div>

    <hr style="margin: 24px 0; border: none; border-top: 1px solid #eee;" />

    <!-- Manual Activation Section -->
    <div style="margin-bottom: 24px;">
      <h4 style="margin: 0 0 12px 0; font-size: 16px;">Manual Activation</h4>
      <p style="margin: 0 0 16px 0; font-weight: normal; color: #666; font-size: 14px;">
        If QR code detection fails, paste your activation code below:
      </p>
      <input type="text" id="code" placeholder="Activation code" style="width: 100%; margin-bottom: 16px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" />
      <button type="submit" id="activateButton" style="width: 100%; margin-bottom: 12px;">Activate</button>
      <p style="margin: 0; font-weight: normal; color: #666; font-size: 13px;">
        Open the link sent to your inbox, and paste the code above.
      </p>
    </div>

    <hr style="margin: 24px 0 16px 0; border: none; border-top: 1px solid #eee;" />
    <div style="display: flex; justify-content: space-between">
      <button id="helpButton">Help</button>
      <button class="toMainScreen">Back to Main</button>
    </div>
  </div>

  <!-- Main TOTP screen -->
  <div class="screen" id="main">
    <div style="display: flex; justify-content: space-between; margin-bottom: 10px">
      <button id="addDevice">Add Device</button>
      <button id="removeDevice">Remove Device</button>
    </div>
  </div>

  <!-- Activation success screen -->
  <div class="screen" id="activationSuccess">
    <h4>Success!</h4>
    <p>Your device has been added successfully.</p>
    <button class="toMainScreen">Continue</button>
  </div>

  <!-- Failed attempts / Help screen -->
  <div class="screen" id="failedAttempts">
    <h4>Need Help?</h4>
    <p>If you're having trouble activating your device:</p>
    <ul>
      <li>Make sure you're on the Duo Mobile activation page</li>
      <li>Check that the QR code is visible and not blocked</li>
      <li>Try refreshing the page and scanning again</li>
      <li>Use manual activation with the code from your email</li>
    </ul>
    <button class="toMainScreen">Back</button>
  </div>
</body>

</html>
