<!DOCTYPE html>
<script src="encryption.js"></script>
<script src="secure-storage.js"></script>
<script src="libs/buffer.js"></script>
<script src="libs/index.js"></script>
<script type="module" src="popup.js"></script>
<html>

<head>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>

<!-- display-none prevents weird visual artifacts from appearing while loading. JS clears the display -->
<body id="content" style="display: none">
  <!-- Logo centered at top -->
  <div style="text-align: center; padding: 16px 0 8px 0;">
    <img style="width: 80px; height: auto; border: none;" src="welcome/logo.png" alt="autoauth" />
  </div>
  
  <div style="display: flex; gap: 8px; align-items: center; padding: 0 16px;">
    <!-- Select device -->
    <select id="deviceSelect">
      <option value="-1">Add Device...</option>
    </select>
    <!-- Device TOTP -->
    <!-- TOTP -->
    <a id="totp">
      <svg viewBox="0 0 16 16">
        <circle cx="8" cy="8" r="4" id="totpCircle" style="animation-duration: 30s"></circle>
      </svg>
      <p id="totpCode"></p>
    </a>
  </div>
  <hr style="margin: 8px 16px;" />

  <!-- Welcome screen -->
  <div class="screen" id="intro">
    <h4 id="disclaimerText">
      This extension is experimental. Functionality could break at any time. Always keep backup devices on your account. This extension is not recognized, endorsed, or affiliated with Duo Mobile or Cisco Technology.
    </h4>
    <hr />
    <h4>
      You're about to add a device to your Duo Mobile account. Login to your
      Duo device manager website.
    </h4>
    <button type="submit" id="introButton">Ok</button>
  </div>

  <!-- Activation screen -->
  <div class="screen" id="activation">
    <h4 id="errorSplash">
    </h4>
    <div class="steps">
      <!-- QR Code Detection Section -->
      <div class="activation-section">
        <p id="qrSearchText">Searching for a QR code...</p>
        <p id="qrErrorText"></p>
        <p style="font-weight: normal">
          Auto 2FA will find the QR code on the current tab.
        </p>
      </div>

      <hr style="margin: 20px 0" />

      <!-- Manual Activation Section -->
      <div class="activation-section">
        <h4>Manual Activation</h4>
        <p style="font-weight: normal">
          If QR code detection fails, paste your activation code below:
        </p>
        <input type="text" id="code" placeholder="Activation code" />
        <br />
        <button type="submit" id="activateButton">Activate</button>
        <p style="font-weight: normal; margin-top: 10px">
          Open the link sent to your inbox, and paste the code above.
        </p>
      </div>
    </div>

    <hr />
    <div style="display: flex; justify-content: space-between">
      <button id="helpButton">Help</button>
      <button class="toMainScreen">Back to Main</button>
    </div>
  </div>

  <!-- Main TOTP screen -->
  <div class="screen" id="main">
    <div style="display: flex; justify-content: space-between; margin-bottom: 10px">
      <button id="addDevice">Add Device</button>
      <button id="removeDevice">Remove Device</button>
    </div>
  </div>

  <!-- Activation success screen -->
  <div class="screen" id="activationSuccess">
    <h4>Success!</h4>
    <p>Your device has been added successfully.</p>
    <button class="toMainScreen">Continue</button>
  </div>

  <!-- Failed attempts / Help screen -->
  <div class="screen" id="failedAttempts">
    <h4>Need Help?</h4>
    <p>If you're having trouble activating your device:</p>
    <ul>
      <li>Make sure you're on the Duo Mobile activation page</li>
      <li>Check that the QR code is visible and not blocked</li>
      <li>Try refreshing the page and scanning again</li>
      <li>Use manual activation with the code from your email</li>
    </ul>
    <button class="toMainScreen">Back</button>
  </div>
</body>

</html>
